import tkinter as tk
from tkinter import messagebox
import pandas as pd
import win32com.client as win32

def filter_data():
    criteria = entry_criteria.get()

    # Validate inputs
    if not criteria:
        messagebox.showerror("Error", "Please enter a filtering criteria.")
        return
    
    try:
        df_filtered = df[df['Criteria Column'].str.contains(criteria, case=False)]  # Assuming 'Criteria Column' is the column header
        generate_emails(df_filtered)
    except Exception as e:
        messagebox.showerror("Error", f"An error occurred while filtering data: {str(e)}")

def generate_emails(filtered_df):
    outlook = win32.Dispatch('Outlook.Application')

    for index, row in filtered_df.iterrows():
        recipient = row['Email']  # Assuming 'Email' is the column header
        subject = 'Your Subject'
        body = 'Your email body'

        mail = outlook.CreateItem(0)
        mail.Subject = subject
        mail.Body = body
        mail.To = recipient
        mail.Save()

    messagebox.showinfo("Success", "Draft emails created and saved in Outlook.")

# Create the main window
window = tk.Tk()
window.title("Filter Data and Create Draft Emails")

# Create criteria entry
label_criteria = tk.Label(window, text="Filtering Criteria:")
label_criteria.pack()
entry_criteria = tk.Entry(window)
entry_criteria.pack()

# Create filter button
button_filter = tk.Button(window, text="Filter Data", command=filter_data)
button_filter.pack()

# Read the data from an Excel file
try:
    df = pd.read_excel('data.xlsx')  # Replace 'data.xlsx' with your file path
except FileNotFoundError:
    messagebox.showerror("Error", "Data file not found.")
    exit()

# Start the main loop
window.mainloop()
